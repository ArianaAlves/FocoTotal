// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ===========================================
// MODELS
// ===========================================

model User {
  id              Int       @id @default(autoincrement())
  name            String
  email           String    @unique
  password        String
  avatar          String?
  coverImage      String?
  bio             String?
  points          Int       @default(0)
  level           Int       @default(1)
  streakDays      Int       @default(0)
  lastActivityDay DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tasks           Task[]
  goals           Goal[]
  achievements    Achievement[]
  pointsHistory   PointsHistory[]
  leaderboard     Leaderboard?

  @@map("users")
}

model Task {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  dueDate     DateTime?
  status      String   @default("PENDENTE") // PENDENTE, CONCLUIDA
  priority    String   @default("MEDIA")    // BAIXA, MEDIA, ALTA
  
  userId      Int
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("tasks")
}

model Goal {
  id              Int      @id @default(autoincrement())
  title           String
  description     String?
  target          Int
  currentProgress Int      @default(0)
  status          String   @default("EM_PROGRESSO") // EM_PROGRESSO, CONCLUIDA, ATRASADA
  category        String   @default("Outros")
  dueDate         DateTime
  
  userId          Int
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("goals")
}

// ===========================================
// GAMIFICATION MODELS
// ===========================================

model Achievement {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  icon        String    @default("‚≠ê")
  points      Int       @default(100)
  condition   String    // ex: "5_TASKS_COMPLETED", "7_DAY_STREAK"
  
  userId      Int
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  unlockedAt  DateTime  @default(now())
  
  @@map("achievements")
}

model PointsHistory {
  id          Int       @id @default(autoincrement())
  userId      Int
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  points      Int
  reason      String    // ex: "TASK_COMPLETED", "ACHIEVEMENT_UNLOCKED"
  reference   String?   // id da task ou achievement
  
  createdAt   DateTime  @default(now())
  
  @@map("points_history")
}

model Leaderboard {
  id          Int       @id @default(autoincrement())
  userId      Int       @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  rank        Int
  totalPoints Int
  tasksCompleted Int @default(0)
  currentStreak Int @default(0)
  
  updatedAt   DateTime  @updatedAt
  
  @@map("leaderboard")
}